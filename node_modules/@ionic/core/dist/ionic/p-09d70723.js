import{p as t}from"./p-c90aaa66.js";const e=new WeakMap,n=(t,n,o,s=0)=>{e.has(t)!==o&&(o?r(t,n,s):a(t,n))},o=t=>t===t.getRootNode().activeElement,r=(t,n,o)=>{const r=n.parentNode,a=n.cloneNode(!1);a.classList.add("cloned-input"),a.tabIndex=-1,r.appendChild(a),e.set(t,a);const s="rtl"===t.ownerDocument.dir?9999:-9999;t.style.pointerEvents="none",n.style.transform=`translate3d(${s}px,${o}px,0) scale(0)`},a=(t,n)=>{const o=e.get(t);o&&(e.delete(t),o.remove()),t.style.pointerEvents="",n.style.transform=""},s="input, textarea, [no-blur]",i=(t,e,o,r)=>{const a=((t,e,n)=>{return((t,e,n,o)=>{const r=t.top,a=t.bottom,s=e.top,i=s+15,l=.5*Math.min(e.bottom,o-n)-a,c=i-r,d=Math.round(l<0?-l:c>0?-c:0),u=Math.min(d,r-s),m=Math.abs(u);return{scrollAmount:u,scrollDuration:Math.min(400,Math.max(150,m/.3)),scrollPadding:n,inputSafeY:4-(r-i)}})((t.closest("ion-item,[ion-item]")||t).getBoundingClientRect(),e.getBoundingClientRect(),n,t.ownerDocument.defaultView.innerHeight)})(t,o,r);Math.abs(a.scrollAmount)<4?e.focus():(n(t,e,!0,a.inputSafeY),e.focus(),o.scrollByPoint(0,a.scrollAmount,a.scrollDuration).then(()=>{n(t,e,!1,a.inputSafeY),e.focus()}))},l=(t,e)=>{if("INPUT"!==t.tagName)return;if(t.parentElement&&"ION-INPUT"===t.parentElement.tagName)return;if(t.parentElement&&t.parentElement.parentElement&&"ION-SEARCHBAR"===t.parentElement.parentElement.tagName)return;const n=t.closest("ion-content");if(null===n)return;const o=n.$ionPaddingTimer;o&&clearTimeout(o),e>0?n.style.setProperty("--keyboard-offset",`${e}px`):n.$ionPaddingTimer=setTimeout(()=>{n.style.setProperty("--keyboard-offset","0px")},120)},c=e=>{const r=document,a=e.getNumber("keyboardHeight",290),c=e.getBoolean("scrollAssist",!0),d=e.getBoolean("hideCaretOnScroll",!0),u=e.getBoolean("inputBlurring",!0),m=e.getBoolean("scrollPadding",!0),p=Array.from(r.querySelectorAll("ion-input, ion-textarea")),f=new WeakMap,E=new WeakMap,g=e=>{const r=(e.shadowRoot||e).querySelector("input")||(e.shadowRoot||e).querySelector("textarea"),s=e.closest("ion-content");if(r){if(s&&d&&!f.has(e)){const t=((t,e,r)=>{if(!r||!e)return()=>{};const a=r=>{o(e)&&n(t,e,r)},s=()=>n(t,e,!1),i=()=>a(!0),l=()=>a(!1);return r.addEventListener("ionScrollStart",i),r.addEventListener("ionScrollEnd",l),e.addEventListener("blur",s),()=>{r.removeEventListener("ionScrollStart",i),r.removeEventListener("ionScrollEnd",l),e.addEventListener("ionBlur",s)}})(e,r,s);f.set(e,t)}if(s&&c&&!E.has(e)){const n=((e,n,r,a)=>{let s;const l=e=>{s=t(e)},c=l=>{if(!s)return;const c=t(l);((t,e,n)=>{if(e&&n){const o=e.x-n.x,r=e.y-n.y;return o*o+r*r>t*t}return!1})(6,s,c)||o(n)||(l.preventDefault(),l.stopPropagation(),i(e,n,r,a))};return e.addEventListener("touchstart",l,!0),e.addEventListener("touchend",c,!0),()=>{e.removeEventListener("touchstart",l,!0),e.removeEventListener("touchend",c,!0)}})(e,r,s,a);E.set(e,n)}}};u&&(()=>{let t=!0,e=!1;const n=document;n.addEventListener("ionScrollStart",()=>{e=!0}),n.addEventListener("focusin",()=>{t=!0},!0),n.addEventListener("touchend",o=>{if(e)return void(e=!1);const r=n.activeElement;if(!r)return;if(r.matches(s))return;const a=o.target;a!==r&&(a.matches(s)||a.closest(s)||(t=!1,setTimeout(()=>{t||r.blur()},50)))},!1)})(),m&&(t=>{const e=document;e.addEventListener("focusin",e=>{l(e.target,t)}),e.addEventListener("focusout",t=>{l(t.target,0)})})(a);for(const t of p)g(t);r.body.addEventListener("ionInputDidLoad",t=>{g(t.target)}),r.body.addEventListener("ionInputDidUnload",t=>{(t=>{if(d){const e=f.get(t);e&&e(),f.delete(t)}if(c){const e=E.get(t);e&&e(),E.delete(t)}})(t.target)})};export{c as startInputShims};